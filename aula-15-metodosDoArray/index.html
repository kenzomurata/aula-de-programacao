<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="./style.css">
</head>
<body>
    <div class="conteiner">
        <div class="topbar">
            <img src="imagens/seta.png" class="setaimg">

            <img src="imagens/questionmark.png" class="questionmarkimg">
        </div>

        <div class="historico">Histórico</div>

        <div class="caixadebusca">

            <button class="button">
                <img src="imagens/lupa.png" class="lupaimg">
            </button>

            <input type="text" id="filtro" class="buscar" name="busca" placeholder="Buscar">
        </div>

        <div id="lista">

        </div>
    </div>

<script>
    window.prompt("Quantos anos você tem?")
    
    var transacoes = [
        {
            id: 1,
            tipoDeTransacao: "Transferência recebida",
            nome: "Fernando Kenzo Murata",
            data: "26/07",
            valor: 12.99,
            icone: "moneyin.png",
        },
        {
            id: 2,
            tipoDeTransacao: "Compra no débito",
            nome: "Farmácia Pacheco",
            data: "02/07",
            valor: 499.99,
            icone: "moneyout.png",
        },
        {
            id: 3,
            tipoDeTransacao: "Transferência recebida",
            nome: "Andréia Zelada Benitez Perpétuo",
            data: "20/07",
            valor: 122.99,
            icone: "moneyin.png",
        },
        {
            id: 4,
            tipoDeTransacao: "Compra no débito",
            nome: "Andréia Zelada Benitez Perpétuo",
            data: "16/06",
            valor: 68.99,
            icone: "moneyout.png",
        },
        {
            id: 5,
            tipoDeTransacao: "Compra no crédito",
            nome: "Prodesporte Perpétuo",
            data: "09/00",
            valor: 80.00,
            icone: "moneyout.png",
        }
    ]

    function criarCardTransacao(transacao) {
        var cardsgrid = window.document.createElement("div")
        var icone = window.document.createElement("div")
        var img = window.document.createElement("img")
        var descricao = window.document.createElement("div")
        var cardtitulo = window.document.createElement("div")
        var titulo = window.document.createElement("div")
        var data = window.document.createElement("div")
        var subtitulo = window.document.createElement("div")
        var nome = window.document.createElement("div")
        var valor = window.document.createElement("div")

        cardsgrid.classList.add("cardsgrid")
        icone.classList.add("icone")
        img.classList.add("img")
        descricao.classList.add("descricao")
        cardtitulo.classList.add("cardtitulo")
        titulo.classList.add("titulo")
        data.classList.add("data")
        subtitulo.classList.add("subtitulo")

        img.src = "imagens/" + transacao.icone

        titulo.innerText = transacao.tipoDeTransacao
        data.innerText = transacao.data

        nome.innerText = transacao.nome
        valor.innerText = transacao.valor.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})

        subtitulo.appendChild(nome)
        subtitulo.appendChild(valor)

        cardtitulo.appendChild(titulo)
        cardtitulo.appendChild(data)

        descricao.appendChild(cardtitulo)
        descricao.appendChild(subtitulo)

        icone.appendChild(img)

        cardsgrid.appendChild(icone)
        cardsgrid.appendChild(descricao)

        lista.appendChild(cardsgrid)

    }

    function criarLista (lista){   
        for(var indice = 0; indice < lista.length; indice += 1){
            criarCardTransacao(lista[indice])
        }
    }

    criarLista(transacoes)

    function tirarAcentos(str){
        str = str.replaceAll(/[ÀÁÂÃÄÅ]/g,"A");
        str = str.replaceAll(/[àáâãäå]/g,"a");
        str = str.replaceAll(/[ÈÉÊË]/g,"E");
        str = str.replaceAll(/[èéêë]/g,"e");
        str = str.replaceAll(/[Ç]/g,"C");
        str = str.replaceAll(/[ç]/g,"c");
        str = str.replaceAll(/[ÍÌÏÎ]/g,"I")
        str = str.replaceAll(/[íìïî]/g,"i")
        str = str.replaceAll(/[ÒÓÔÖÕ]/g,"O")
        str = str.replaceAll(/[óòõöô]/g,"o")
        str = str.replaceAll(/[ÙÚÛÜ]/g,"U")
        str = str.replaceAll(/[úùüû]/g,"u")

        return str; 
    }

    function filtrarTransacoes (){
        var inputBuscar = window.document.getElementById("filtro").value
        
        var transacoesFiltradas = []

        /*for(var indice = 0; indice < transacoes.length; indice += 1){
            transacoes[indice.tipoDeTransacao]

            var tipo = transacoes[indice].tipoDeTransacao.toLowerCase()
            var busca = inputBuscar.toLowerCase()

            if (tipo.includes(busca)) {
                transacoesFiltradas.push(transacoes[indice])
            }
        }*/

        transacoes.forEach(function(transacao){
            var jaInseridoEmFiltrados = false

            var busca = inputBuscar.toLowerCase()
            busca = tirarAcentos(busca)

            var tipo = transacao.tipoDeTransacao.toLowerCase()
            tipo = tirarAcentos(tipo)

            var nome = transacao.nome.toLowerCase()
            nome = tirarAcentos(nome)

            var valorString = transacao.valor.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})
            valorString.toLocaleLowerCase()

            console.log("busca", busca)
            console.log("tipo", tipo)
            console.log("nome", nome)

            if (tipo.includes(busca)) {
                transacoesFiltradas.push(transacao)
                jaInseridoEmFiltrados = true
            }

            if (nome.includes(busca) && !jaInseridoEmFiltrados) {
                transacoesFiltradas.push(transacao)
                jaInseridoEmFiltrados = true
            }

            if (valorString.includes(busca) && !jaInseridoEmFiltrados) {
                transacoesFiltradas.push(transacao)
            }
        })

        var lista = document.getElementById("lista")
        lista.innerHTML = ""

        criarLista(transacoesFiltradas)
    }

    var selecao = window.document.getElementsByClassName("button")
    var botao = selecao[0]

    botao.addEventListener("click", filtrarTransacoes)

    /*
    function existeNaLista (item, lista){
        var encontrado = lista.find(function(itemLista){
            if (item.id == itemLista.id){
                return true
            }
            return false                    
        })

        if(encontrado == undefined) {
            return false;
        }

        return true;
    }
    */

</script>




</body>