<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
  </head>
  <body>
    <script>
      var player = {
        nome: "",
        equipamentos: [],
        item: [],
      };

      var equipamentosDisponiveis = [
        { id: 1, nome: "Espada" },
        { id: 2, nome: "Arco e Flecha" },
        { id: 3, nome: "Armadura" },
        { id: 4, nome: "Lança" },
      ];

      var pontoFinal = {
        montarHistoria: function (nome) {
          return `${nome}! Você chegou ao Fim!`;
        },
        nome: "Terra Prometida",
      };

      var pontoD = {
        nome: "Encurralado por mortos-vivos",
        montarHistoria: function (nome) {
          var historia = `${nome} sai do ponto B/C mas é surpreendido por uma manada de mortos-vivos, encontrando-se sem saída a não ser lutar...`;
          return historia;
        },
        escolhas: [pontoFinal],
      };

      var pontoB = {
        nome: "Templo Antigo, emandando uma intensa magia",
        montarHistoria: function (nome) {
          var historia = `Dentro do Templo Antigo ${nome} se depara com um Amuleto de Transmutação, onde logo o pega e guarda em seu invetário`;
          return historia;
        },
        escolhas: [pontoD],
        item: "Amuleto de Transmutação",
      };

      var pontoC = {
        nome: "Caverna Subterrânea, emanando uma energia ardente",
        montarHistoria: function (nome) {
          var historia = `Dentro da Carverna Subterrânea ${nome} se depara com um Amuleto Lança-Chamas, onde logo o pega e guarda em seu invetário`;
          return historia;
        },
        escolhas: [pontoD],
        item: "Amuleto Lança-Chamas",
      };

      var pontoA = {
        montarHistoria: function (nome) {
          var historia = `${nome} começa sua jornada em direção a "Terra Prometida", mas para chegar lá precisa atravessar o "Deserto dos Mortos". Chegando no deserto, ${nome} se depara com dois caminhos...`;
          for (var indice = 0; indice < this.escolhas.length; indice += 1) {
            historia = historia.concat(
              `\n ${indice + 1}` + "- " + this.escolhas[indice].nome
            );
          }
          return historia;
        },
        escolhas: [pontoB, pontoC],
      };

      /* var pontoD = {
        historia: msgHistoria2,
      }; */

      var caminhosHistoria1 = [
        { id: 1, caminho: "Templo Antigo, emandando uma intensa magia" },
        { id: 2, caminho: "Caverna Subterrânea, emanando uma energia ardente" },
      ];

      var MSG_EQUIPAMENTO1 = function (ordem) {
        return `Escolha o número do seu ${ordem}° equipamento:\n`;
      };

      function removerEquipamento(escolha) {
        equipamentosDisponiveis = equipamentosDisponiveis.filter(function (
          equipamento
        ) {
          return escolha != equipamento.id;
        });
      }

      function montarFrase(fraseInicial, equipamentos) {
        var frase = fraseInicial;
        for (var indice = 0; indice < equipamentos.length; indice += 1) {
          frase = frase.concat(
            equipamentos[indice].id + "- " + equipamentos[indice].nome + "\n"
          );
        }
        return frase;
      }

      function escolherArmas(player) {
        while (player.equipamentos.length < 2) {
          var escolha = window.prompt(
            montarFrase(
              MSG_EQUIPAMENTO1(player.equipamentos.length + 1),
              equipamentosDisponiveis
            )
          );
          var ehEquipamentoValido = equipamentosDisponiveis.some(function (
            equipamento
          ) {
            return equipamento.id == escolha;
          });

          if (ehEquipamentoValido) {
            var equipEscolhido = equipamentosDisponiveis.find(function (equip) {
              return escolha == equip.id;
            });

            player.equipamentos.push(equipEscolhido);
            removerEquipamento(escolha);
          }
        }
      }

      function montarHistoria1(fraseHistoria, caminhos) {
        var frase = fraseHistoria;
        for (var indice = 0; indice < caminhos.length; indice += 1) {
          frase = frase.concat(
            caminhos[indice].id + "- " + caminhos[indice].caminho + "\n"
          );
        }
        return frase;
      }

      while (player.nome == "") {
        player.nome = window.prompt("Escolha seu nome:");
      }

      escolherArmas(player);

      console.log(player);

      var pontoAtual = pontoA;

      while (pontoAtual.nome != pontoFinal.nome) {
        if (pontoAtual.escolhas.length == 1) {
          alert(pontoAtual.montarHistoria(player.nome));
          pontoAtual = pontoAtual.escolhas[0];
        } else {
          var caminhoEscolhido = window.prompt(
            //montarHistoria1(msgHistoria1(player.nome), caminhosHistoria1)
            pontoAtual.montarHistoria(player.nome)
          );
          pontoAtual = pontoAtual.escolhas[caminhoEscolhido - 1];
        }
        console.log(pontoAtual);
      }

      alert(pontoFinal.montarHistoria(player.nome));
    </script>
  </body>
</html>
